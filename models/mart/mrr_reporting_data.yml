models:
  - name: mrr_reporting_data
    description: The invoice model contains data on each invoice generated by a customer. The amount of each invoice has been converted to euros, and an extra columns that calculates the days between the start and end period of an invoice
    columns:
      - name: id
        description: invoice_id of each invoice
      - name: invoice_id
        description: This is the Foreign key. ID of an invoice

      - name: customer_id

      - name: type

      - name: currency

      - name: period_end

      - name: period_start

      - name: days_between_invoice_start_and_invoice_end_date

      - name: _synced

      - name: amount

      - name: amount_in_eur
      

semantic_models:
  - model: ref('mrr_reporting_data')
    name: invoice
    description: semantic model for the invoice and invoice item tables
    defaults:
      agg_time_dimension: period_start
    entities:
      - name: id
        type: primary
        expr: id

      - name: invoice
        type: foreign
        expr: invoice_id

      - name: customer
        type: foreign
        expr: customer_id

    dimensions:
      - name: type
        description: invoice type
        type: categorical

      - name: currency
        description: local currency of invoice
        type: categorical

      - name: period_end
        expr: DATE(period_end)
        type: time
        type_params:
          time_granularity: day

      - name: period_start
        expr: DATE(period_start)
        type: time
        type_params:
          time_granularity: day


    measures:
      - name: amount
        description: amount in local currency for an invoice
        agg: sum

      - name: amount_in_eur
        description: amount converted to euros to be used for reporting
        agg: sum

      - name: days_between_invoice_start_and_invoice_end_date
        description: period covered for invoice
        agg: sum


metrics:
    - name: amount_in_eur
      description: "amount converted to euros."
      type: SIMPLE
      label: amount_in_eur
      type_params:
        measure: 
          name: amount_in_eur

    - name: days_between_invoice_start_and_invoice_end_date
      description: "amount converted to euros."
      type: SIMPLE
      label: days_between_invoice_start_and_invoice_end_date
      type_params:
        measure: 
          name: days_between_invoice_start_and_invoice_end_date

    - name: monthly_recurring_revenue
      label: monthly_recurring_revenue  
      description: "The gross profit for each food order."
      type: derived
      type_params:
        expr: amount_in_eur / days_between_invoice_start_and_invoice_end_date
        metrics:
          - name: amount_in_eur
          - name: days_between_invoice_start_and_invoice_end_date
      filter: |
          {{ Dimension('invoice__type') }}  = 'subscription'
          
        





          


    
            
        
